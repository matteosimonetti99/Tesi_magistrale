<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulation Parameters</title>
    <style>
        body {
            font-family: sans-serif;
        }
        form {
            display: flex;
            flex-direction: column;
            width: 50%;
            margin: 0 auto;
        }
        h1 {
            display: flex;
            flex-direction: column;
            width: 50%;
            margin: 0 auto;
        }
        label {
            margin-top: 10px;
        }
        input, select {
            border-radius: 4px;
            padding: 5px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
        }
        button {
            border-radius: 4px;
            padding: 10px;
            margin: 5px;
            color: white;
            border: none;
            cursor: pointer;
            background-color: #1d64ff;
        }
        .greenBg{
            background-color: #4CAF50;
        }
        .redBg{
            background-color: hsl(0, 68%, 52%);
        }
        .blueBg{
            background-color: #1e32ee;
        }
        .resource-group, .timetable-group {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <h1>Simulation Parameters</h1>
    <br><br>
    <form method="POST" action="{{ url_for('parameters') }}">
        <label for="inter_arrival_time_type">Inter Arrival Time Type:</label>
        <select id="inter_arrival_time_type" name="inter_arrival_time_type">
            <option value="FIXED">Fixed</option>
            <option value="NORMAL">Normal</option>
            <option value="EXPONENTIAL">Exponential</option>
            <option value="UNIFORM">Uniform</option>
            <option value="TRIANGULAR">Triangular</option>
            <option value="LOGNORMAL">Log-Normal</option>
            <option value="GAMMA">Gamma</option>
            <option value="HISTOGRAM">Histogram</option>
        </select>

        <label for="inter_arrival_time_mean">Mean:</label>
        <input type="number" id="inter_arrival_time_mean" name="inter_arrival_time_mean" required>
        <label for="inter_arrival_time_arg1">Arg1 (if applicable):</label>
        <input type="number" id="inter_arrival_time_arg1" name="inter_arrival_time_arg1">
        <label for="inter_arrival_time_arg2">Arg2 (if applicable):</label>
        <input type="number" id="inter_arrival_time_arg2" name="inter_arrival_time_arg2">
        <label for="inter_arrival_time_time_unit">Time Unit:</label>
        <select id="inter_arrival_time_time_unit" name="inter_arrival_time_time_unit">
            <option value="seconds">seconds</option>
            <option value="minutes">minutes</option>
            <option value="hours">hours</option>
            <option value="days">days</option>
        </select>
        <br>
        <label for="instances">Total number of process instances:</label>
        <input type="number" id="instances" name="instances" required value="1"> <br>
        <label for="start_date">Scenario start date and time:</label>
        <input type="datetime-local" id="start_date" name="start_date">
        
        <h2>Resources</h2>
        <div id="resources-container">
        </div>
        <button type="button" onclick="addResource()">Add Resource</button>

        <h2>Timetables / Work schedules</h2>
        <div id="timetables-container">
        </div>
        <button type="button" onclick="addTimetable()">Add Timetable</button>
        <br><br>
        <button type="submit">Save Parameters and Run Simulation</button>
    </form>

    <script>
        let resourceCounter = 0;
        let timetableCounter = 0;
        let ruleCounter = {}; 

        function addResource() {
            resourceCounter++;
            const resourcesContainer = document.getElementById('resources-container');
            const resourceDiv = document.createElement('div');
            resourceDiv.classList.add('resource-group');
            resourceDiv.innerHTML = `
                <h3>Resource ${resourceCounter}</h3>
                <label for="resource_name_${resourceCounter}">Name:</label>
                <input type="text" id="resource_name_${resourceCounter}" name="resource_name_${resourceCounter}" required>
                <label for="resource_amount_${resourceCounter}"># of Resources:</label>
                <input type="number" id="resource_amount_${resourceCounter}" name="resource_amount_${resourceCounter}" required>
                <label for="resource_cost_${resourceCounter}">Cost per Hour:</label>
                <input type="number" id="resource_cost_${resourceCounter}" name="resource_cost_${resourceCounter}" required>
                <label for="resource_timetable_${resourceCounter}">Timetable:</label>
                <select id="resource_timetable_${resourceCounter}" name="resource_timetable_${resourceCounter}">                    
                </select>
                <button type="button" class="redBg" onclick="removeResource(this)">Remove</button>
            `;
            resourcesContainer.appendChild(resourceDiv);
            updateTimetableOptions(); 
        }

        function removeResource(button) {
            const resourceDiv = button.parentElement;
            resourceDiv.remove();
            updateTimetableOptions(); 
        }

        function addTimetable() {
            timetableCounter++;
            ruleCounter[timetableCounter] = 0; // Initialize rule counter for this timetable
            const timetablesContainer = document.getElementById('timetables-container');
            const timetableDiv = document.createElement('div');
            timetableDiv.classList.add('timetable-group');
            timetableDiv.innerHTML = `
                <h3>Timetable ${timetableCounter}</h3>
                <label for="timetable_name_${timetableCounter}">Name:</label>
                <input type="text" id="timetable_name_${timetableCounter}" name="timetable_name_${timetableCounter}" required>
                <div id="rules-container-${timetableCounter}">
                </div>
                <button type="button" onclick="addRule(${timetableCounter})">Add Rule</button>
                <button type="button" class="redBg" onclick="removeTimetable(this)">Remove</button>
            `;
            timetablesContainer.appendChild(timetableDiv);
            updateTimetableOptions(); 
        }

        function removeTimetable(button) {
            const timetableDiv = button.parentElement;
            timetableDiv.remove();
            updateTimetableOptions(); 
        }

        function addRule(timetableNum) {
            ruleCounter[timetableNum]++;
            const rulesContainer = document.getElementById(`rules-container-${timetableNum}`);
            const ruleDiv = document.createElement('div');
            ruleDiv.innerHTML = `
                <h4>Rule ${ruleCounter[timetableNum]}</h4>
                <label for="rule_from_time_${timetableNum}_${ruleCounter[timetableNum]}">From Time:</label>
                <input type="time" id="rule_from_time_${timetableNum}_${ruleCounter[timetableNum]}" name="rule_from_time_${timetableNum}_${ruleCounter[timetableNum]}" required>
                <label for="rule_to_time_${timetableNum}_${ruleCounter[timetableNum]}">To Time:</label>
                <input type="time" id="rule_to_time_${timetableNum}_${ruleCounter[timetableNum]}" name="rule_to_time_${timetableNum}_${ruleCounter[timetableNum]}" required>
                <label for="rule_from_day_${timetableNum}_${ruleCounter[timetableNum]}">From Day:</label>
                <select id="rule_from_day_${timetableNum}_${ruleCounter[timetableNum]}" name="rule_from_day_${timetableNum}_${ruleCounter[timetableNum]}">
                    <option value="MONDAY">Monday</option>
                    <option value="TUESDAY">Tuesday</option>
                    <option value="WEDNESDAY">Wednesday</option>
                    <option value="THURSDAY">Thursday</option>
                    <option value="FRIDAY">Friday</option>
                    <option value="SATURDAY">Saturday</option>
                    <option value="SUNDAY">Sunday</option>
                </select>
                <label for="rule_to_day_${timetableNum}_${ruleCounter[timetableNum]}">To Day:</label>
                <select id="rule_to_day_${timetableNum}_${ruleCounter[timetableNum]}" name="rule_to_day_${timetableNum}_${ruleCounter[timetableNum]}">
                    <option value="MONDAY">Monday</option>
                    <option value="TUESDAY">Tuesday</option>
                    <option value="WEDNESDAY">Wednesday</option>
                    <option value="THURSDAY">Thursday</option>
                    <option value="FRIDAY">Friday</option>
                    <option value="SATURDAY">Saturday</option>
                    <option value="SUNDAY">Sunday</option>
                </select>
                <button type="button" class="redBg" onclick="removeRule(this, ${timetableNum})">Remove</button>
            `;
            rulesContainer.appendChild(ruleDiv);
            updateTimetableOptions()
        }

        function removeRule(button, timetableNum) {
            const ruleDiv = button.parentElement;
            ruleDiv.remove();
            ruleCounter[timetableNum]--; // Decrement rule counter for the timetable
        }
        function updateTimetableOptions() {
            // Get all the timetable name input fields
            let timetableNames = [];
            for (let i = 0; i <= timetableCounter; i++) {
                let timetableNameInput = document.getElementById(`timetable_name_${i}`);
                if (timetableNameInput) { 
                    timetableNames.push(timetableNameInput.value);
                }
            }

            // Update the options for each resource's timetable select
            for (let i = 1; i <= resourceCounter; i++) {
                let timetableSelect = document.getElementById(`resource_timetable_${i}`);
                if (timetableSelect) {
                    // Clear existing options
                    timetableSelect.innerHTML = ''; 
                    // Add options for each available timetable
                    timetableNames.forEach(name => {
                        timetableSelect.add(new Option(name, name));
                    });
                }
            }
        }
    </script>

</body>
</html>